<!--<% layout("/layouts/boilerplate") %>

<style>
  .product-container {
    max-width: 900px;
    margin: 30px auto;
    padding: 30px;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    font-family: 'Segoe UI', sans-serif;
  }

  .product-images img {
    max-width: 180px;
    border-radius: 10px;
    margin: 0 10px 20px 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  .product-options span {
    padding: 8px 16px;
    margin: 5px 10px 5px 0;
    border: 1px solid #ccc;
    border-radius: 20px;
    cursor: pointer;
    display: inline-block;
    transition: all 0.3s ease;
  }

  .product-options span.selected {
    background: #000;
    color: #fff;
    border-color: #000;
  }

  .add-to-cart-btn {
    padding: 12px 30px;
    background-color: #007bff;
    color: white;
    font-weight: bold;
    border: none;
    border-radius: 25px;
    margin-top: 20px;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .add-to-cart-btn:hover {
    background-color: #0056b3;
  }
</style>

<div class="product-container">
  <h1><%= product.name %></h1>
  <p><strong>Brand:</strong> <%= product.brand %></p>
  <p><strong>Category:</strong> <%= product.category %></p>
  <p><strong>Section:</strong> <%= product.section %></p>

  <div class="product-images">
    <% product.images?.forEach(img => { %>
      <img src="<%= img %>" alt="Product Image">
    <% }) %>
  </div>

  <p><strong>Description:</strong> <%= product.description %></p>

  <p><strong>Available Sizes:</strong></p>
  <div class="product-options" id="size-options">
    <% product.sizes?.forEach(size => { %>
      <span data-size="<%= size %>"><%= size %></span>
    <% }) %>
  </div>

  <p><strong>Available Colors:</strong></p>
  <div class="product-options" id="color-options">
    <% product.colors?.forEach(color => { %>
      <span data-color="<%= color %>"><%= color %></span>
    <% }) %>
  </div>

  <p><strong>Price:</strong> ₹<%= product.price %></p>

  <% if (product.discount > 0) { %>
    <p><strong>Discount:</strong> <%= product.discount %>% OFF</p>
    <p><strong>Discounted Price:</strong> ₹<%= product.price - (product.price * product.discount / 100) %></p>
  <% } %>

  <p><strong>Stock Left:</strong> <%= product.stock %> items</p>

  <% if (product.createdAt) { %>
    <p><em>Added on: <%= product.createdAt.toDateString() %></em></p>
  <% } else { %>
    <p><em>Added on: Unknown</em></p>
  <% } %>

  <button class="add-to-cart-btn" onclick="addToCart()">Add to Cart</button>
</div>

<!-- ✅ Product data in JS context 
 <script>
  const product = {
    _id: "<%= product._id %>",
    name: "<%= product.name %>",
    price: <%= product.price %>,
    discount: <%= product.discount %>,
    image: "<%= product.images?.[0] || '' %>"
  };
</script>

 ✅ Cart logic 
<script>
  const sizeOptions = document.querySelectorAll('#size-options span');
  const colorOptions = document.querySelectorAll('#color-options span');
  let selectedSize = null;
  let selectedColor = null;

  sizeOptions.forEach(el => {
    el.addEventListener('click', () => {
      sizeOptions.forEach(btn => btn.classList.remove('selected'));
      el.classList.add('selected');
      selectedSize = el.dataset.size;
    });
  });

  colorOptions.forEach(el => {
    el.addEventListener('click', () => {
      colorOptions.forEach(btn => btn.classList.remove('selected'));
      el.classList.add('selected');
      selectedColor = el.dataset.color;
    });
  });

  function addToCart() {
    if (!selectedSize || !selectedColor) {
      alert('Please select both size and color before adding to cart.');
      return;
    }

    const cartItem = {
      id: product._id,
      name: product.name,
      size: selectedSize,
      color: selectedColor,
      price: product.price,
      discount: product.discount,
      image: product.image,
    };

    const existingCart = JSON.parse(localStorage.getItem("cart")) || [];
    existingCart.push(cartItem);
    localStorage.setItem("cart", JSON.stringify(existingCart));

    alert(`Added to cart:\n${cartItem.name}\nSize: ${cartItem.size}\nColor: ${cartItem.color}`);
    window.location.href = "/cart";
  }
</script>
<% layout("/layouts/boilerplate") %>

<style>
  .product-container {
    max-width: 900px;
    margin: 40px auto;
    padding: 30px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    font-family: 'Segoe UI', sans-serif;
  }

  .product-title {
    font-size: 32px;
    margin-bottom: 10px;
    font-weight: 600;
  }

  .product-meta p {
    font-size: 16px;
    margin: 6px 0;
  }

  .product-images {
    display: flex;
    flex-wrap: wrap;
    margin: 20px 0;
  }

  .product-images img {
    max-width: 180px;
    border-radius: 12px;
    margin: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .product-options span {
    padding: 10px 20px;
    margin: 5px 10px 5px 0;
    border: 1px solid #ccc;
    border-radius: 25px;
    cursor: pointer;
    display: inline-block;
    transition: all 0.3s ease;
  }

  .product-options span.selected {
    background: #007bff;
    color: white;
    border-color: #007bff;
  }

  .price-box {
    margin-top: 20px;
  }

  .price-original {
    text-decoration: line-through;
    color: #999;
    font-size: 20px;
  }

  .price-discounted {
    color: green;
    font-size: 26px;
    font-weight: bold;
    margin-left: 10px;
  }

  .discount-tag {
    background: #ff4d4d;
    color: white;
    padding: 4px 10px;
    border-radius: 5px;
    margin-left: 10px;
    font-size: 14px;
  }

  .add-to-cart-btn {
    padding: 14px 40px;
    background-color: #28a745;
    color: white;
    font-weight: bold;
    font-size: 16px;
    border: none;
    border-radius: 30px;
    margin-top: 30px;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .add-to-cart-btn:hover {
    background-color: #218838;
  }

  .product-footer {
    font-size: 14px;
    margin-top: 20px;
    color: #555;
  }
</style>

<div class="product-container">
  <div class="product-title"><%= product.name %></div>
  <div class="product-meta">
    <p><strong>Brand:</strong> <%= product.brand %></p>
    <p><strong>Category:</strong> <%= product.category %></p>
    <p><strong>Section:</strong> <%= product.section %></p>
  </div>

  <div class="product-images">
    <% product.images?.forEach(img => { %>
      <img src="<%= img %>" alt="Product Image">
    <% }) %>
  </div>

  <p><strong>Description:</strong> <%= product.description %></p>

  <p><strong>Available Sizes:</strong></p>
  <div class="product-options" id="size-options">
    <% product.sizes?.forEach(size => { %>
      <span data-size="<%= size %>"><%= size %></span>
    <% }) %>
  </div>

  <p><strong>Available Colors:</strong></p>
  <div class="product-options" id="color-options">
    <% product.colors?.forEach(color => { %>
      <span data-color="<%= color %>"><%= color %></span>
    <% }) %>
  </div>

  <div class="price-box">
    <% if (product.discount > 0) { %>
      <span class="price-original">₹<%= product.price %></span>
      <span class="price-discounted">₹<%= product.price - (product.price * product.discount / 100) %></span>
      <span class="discount-tag"><%= product.discount %>% OFF</span>
    <% } else { %>
      <span class="price-discounted">₹<%= product.price %></span>
    <% } %>
  </div>

  <p><strong>Stock Left:</strong> <%= product.stock %> items</p>

  <div class="product-footer">
    <% if (product.createdAt) { %>
      <p>Added on: <%= product.createdAt.toDateString() %></p>
    <% } else { %>
      <p>Added on: Unknown</p>
    <% } %>
  </div>

  <button class="add-to-cart-btn" onclick="addToCart()">Add to Cart</button>
</div>

<script>
  const product = {
    _id: "<%= product._id %>",
    name: "<%= product.name %>",
    price: <%= product.price %>,
    discount: <%= product.discount %>,
    image: "<%= product.images?.[0] || '' %>"
  };

  const sizeOptions = document.querySelectorAll('#size-options span');
  const colorOptions = document.querySelectorAll('#color-options span');
  let selectedSize = null;
  let selectedColor = null;

  sizeOptions.forEach(el => {
    el.addEventListener('click', () => {
      sizeOptions.forEach(btn => btn.classList.remove('selected'));
      el.classList.add('selected');
      selectedSize = el.dataset.size;
    });
  });

  colorOptions.forEach(el => {
    el.addEventListener('click', () => {
      colorOptions.forEach(btn => btn.classList.remove('selected'));
      el.classList.add('selected');
      selectedColor = el.dataset.color;
    });
  });

  function addToCart() {
    if (!selectedSize || !selectedColor) {
      alert('Please select both size and color before adding to cart.');
      return;
    }

    const cartItem = {
      id: product._id,
      name: product.name,
      size: selectedSize,
      color: selectedColor,
      price: product.price,
      discount: product.discount,
      image: product.image,
    };

    const existingCart = JSON.parse(localStorage.getItem("cart")) || [];
    existingCart.push(cartItem);
    localStorage.setItem("cart", JSON.stringify(existingCart));

   // alert(`Added to cart:\n${cartItem.name}\nSize: ${cartItem.size}\nColor: ${cartItem.color}`);
    window.location.href = "/cart";
  }
</script>-->
<% layout("/layouts/boilerplate") %>

<style>
  .product-container {
    max-width: 900px;
    margin: 40px auto;
    padding: 30px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    font-family: 'Segoe UI', sans-serif;
  }

  .product-title {
    font-size: 32px;
    margin-bottom: 10px;
    font-weight: 600;
  }

  .product-meta p {
    font-size: 16px;
    margin: 6px 0;
  }
  .quantity-selector {
    margin: 20px 0;
  }

  .quantity-selector input {
    width: 60px;
    text-align: center;
    padding: 8px;
    font-size: 16px;
  }

  .product-images {
    display: flex;
    flex-wrap: wrap;
    margin: 20px 0;
  }

  .product-images img {
    max-width: 180px;
    border-radius: 12px;
    margin: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .product-options span {
    padding: 10px 20px;
    margin: 5px 10px 5px 0;
    border: 1px solid #ccc;
    border-radius: 25px;
    cursor: pointer;
    display: inline-block;
    transition: all 0.3s ease;
  }

  .product-options span.selected {
    background: #007bff;
    color: white;
    border-color: #007bff;
  }

  .price-box {
    margin-top: 20px;
  }

  .price-original {
    text-decoration: line-through;
    color: #999;
    font-size: 20px;
  }

  .price-discounted {
    color: green;
    font-size: 26px;
    font-weight: bold;
    margin-left: 10px;
  }

  .discount-tag {
    background: #ff4d4d;
    color: white;
    padding: 4px 10px;
    border-radius: 5px;
    margin-left: 10px;
    font-size: 14px;
  }

  .add-to-cart-btn {
    padding: 14px 40px;
    background-color: #28a745;
    color: white;
    font-weight: bold;
    font-size: 16px;
    border: none;
    border-radius: 30px;
    margin-top: 30px;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .add-to-cart-btn:hover {
    background-color: #218838;
  }

  .wishlist-btn {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #ff4d4d;
    float: right;
  }
  .product-footer {
    font-size: 14px;
    margin-top: 20px;
    color: #555;
  }
  .review-section {
    padding: 2rem;
    border-top: 1px solid #e0e0e0;
    background-color: #fdfdfd;
  }

  .review-section h3 {
    font-size: 1.8rem;
    color: #3b82f6;
    font-weight: 600;
    margin-bottom: 1.5rem;
  }

  .review-card {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 12px;
    padding: 1rem 1.5rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
  }

  .review-card strong {
    color: #222;
    font-size: 1rem;
  }

  .review-card .rating {
    color: #f59e0b;
    margin-left: 8px;
    font-size: 1rem;
  }

  .review-card p {
    margin: 0.5rem 0 0;
    color: #444;
    font-size: 0.95rem;
  }

  .review-form {
    background: #f5faff;
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 2rem;
    border: 1px solid #d3eaff;
  }

  .review-form label {
    display: block;
    margin-bottom: 0.4rem;
    font-weight: 500;
    color: #333;
  }

  .review-form select,
  .review-form textarea {
    width: 100%;
    border: 1px solid #ccc;
    padding: 0.6rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    font-size: 0.95rem;
    font-family: inherit;
  }

  .review-form button {
    background-color: #10b981;
    color: #fff;
    padding: 0.6rem 1.2rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.3s ease;
  }

  .review-form button:hover {
    background-color: #059669;
  }

  .login-msg {
    background: #e0f2fe;
    color: #0369a1;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1.5rem;
  }

  .login-msg a {
    color: #0284c7;
    font-weight: bold;
    text-decoration: none;
  }

</style>

<div class="product-container">
  <div class="product-title">
    <%= product.name %>
    <button class="wishlist-btn" onclick="addToWishlist()">❤️</button>
  </div>
  <div class="product-meta">
    <p><strong>Brand:</strong> <%= product.brand %></p>
    <p><strong>Category:</strong> <%= product.category %></p>
    <p><strong>Section:</strong> <%= product.section %></p>
  </div>

  <div class="product-images">
    <% product.images?.forEach(img => { %>
      <img src="<%= img %>" alt="Product Image">
    <% }) %>
  </div>

  <p><strong>Description:</strong> <%= product.description %></p>

  <p><strong>Available Sizes:</strong></p>
  <div class="product-options" id="size-options">
    <% product.sizes?.forEach(size => { %>
      <span data-size="<%= size %>"><%= size %></span>
    <% }) %>
  </div>

  <p><strong>Available Colors:</strong></p>
  <div class="product-options" id="color-options">
    <% product.colors?.forEach(color => { %>
      <span data-color="<%= color %>"><%= color %></span>
    <% }) %>
  </div>

  <div class="price-box">
    <% if (product.discount > 0) { %>
      <span class="price-original">₹<%= product.price %></span>
      <span class="price-discounted">₹<%= Number(product.price - (product.price * product.discount / 100)).toFixed(2) %></span>
      <span class="discount-tag"><%= product.discount %>% OFF</span>
    <% } else { %>
      <span class="price-discounted">₹<%= product.price %></span>
    <% } %>
  </div>

  <p><strong>Stock Left:</strong> <%= product.stock %> items</p>
 <div class="quantity-selector">
    <label><strong>Quantity:</strong></label>
    <input type="number" id="quantity" min="1" max="<%= product.stock %>" value="1">
  </div>
  <div class="product-footer">
    <% if (product.createdAt) { %>
      <p>Added on: <%= product.createdAt.toDateString() %></p>
    <% } else { %>
      <p>Added on: Unknown</p>
    <% } %>
  </div>

  <button class="add-to-cart-btn" onclick="addToCart()">Add to Cart</button>
  
 <div class="container mt-5 p-4 rounded shadow-sm border bg-white">
  <% if (currUser) { %>
    <h4 class="mb-3">Leave a Review</h4>
    <form action="/products/<%= product._id %>/reviews" method="POST" novalidate class="needs-validation">
      <div class="mb-3">
        <label class="form-label fw-bold">Rating:</label>
        <fieldset class="starability-slot">
          <input type="radio" id="no-rate" class="input-no-rate" name="rating" value="0" checked aria-label="No rating." />
          <input type="radio" id="first-rate1" name="rating" value="1" />
          <label for="first-rate1" title="Terrible">1 star</label>
          <input type="radio" id="first-rate2" name="rating" value="2" />
          <label for="first-rate2" title="Not good">2 stars</label>
          <input type="radio" id="first-rate3" name="rating" value="3" />
          <label for="first-rate3" title="Average">3 stars</label>
          <input type="radio" id="first-rate4" name="rating" value="4" />
          <label for="first-rate4" title="Very good">4 stars</label>
          <input type="radio" id="first-rate5" name="rating" value="5" />
          <label for="first-rate5" title="Amazing">5 stars</label>
        </fieldset>
      </div>

      <div class="mb-3">
     <div class="max-w-xl mx-auto bg-white shadow-md rounded-lg p-6 mt-6">
  <form action="/products/<%= product._id %>/reviews" method="POST" class="space-y-4">
    
    <div>
      <label for="rating" class="block text-sm font-medium text-gray-700">Rating (1-5)</label>
      <input 
        type="number" 
        name="review[rating]" 
        min="1" max="5" 
        required 
        class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
      />
    </div>

    <div>
      <label for="comment" class="block text-sm font-medium text-gray-700">Comment</label>
      <textarea 
        name="review[comment]" 
        rows="4" 
        required 
        class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
      ></textarea>
    </div>

    <button 
      type="submit" 
      class="w-full bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-indigo-700 transition duration-200"
    >
      Submit Review
    </button>
    
  </form>
</div>
</div>
    <hr class="my-4">
  <% } else { %>
    <div class="alert alert-info">
      <a href="/login" class="btn btn-primary">Login to write a review</a>
    </div>
  <% } %>

  <h4 class="mt-4 mb-3">Customer Reviews</h4>
  <div class="row">
    <% if (product.reviews && product.reviews.length > 0) { %>
      <% product.reviews.forEach(rev => { %>
        <div class="col-md-6">
          <div class="card mb-4 shadow-sm border">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">@<%= rev.user?.username || "unknown" %></h6>
              <div class="mb-2">
                <span class="badge bg-warning text-dark"><%= rev.rating %> ★</span>
              </div>
              <p class="card-text"><%= rev.comment %></p>

     <% if (currUser && rev.user && currUser._id.toString() === rev.user._id.toString()) { %>
  <form method="POST" action="/products/<%= product._id %>/reviews/<%= rev._id %>?_method=DELETE" class="mt-2">
    <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
  </form>
<% } %>
            </div>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="col-12">
        <p class="text-muted">No reviews available for this product.</p>
      </div>
    <% } %>
  </div>
</div>

<script>
  const product = {
    _id: "<%= product._id %>",
    name: "<%= product.name %>",
    price: <%= product.price %>,
    discount: <%= product.discount %>,
    image: "<%= product.images?.[0] || '' %>"
  };

  const sizeOptions = document.querySelectorAll('#size-options span');
  const colorOptions = document.querySelectorAll('#color-options span');
  let selectedSize = null;
  let selectedColor = null;

  sizeOptions.forEach(el => {
    el.addEventListener('click', () => {
      sizeOptions.forEach(btn => btn.classList.remove('selected'));
      el.classList.add('selected');
      selectedSize = el.dataset.size;
    });
  });

  colorOptions.forEach(el => {
    el.addEventListener('click', () => {
      colorOptions.forEach(btn => btn.classList.remove('selected'));
      el.classList.add('selected');
      selectedColor = el.dataset.color;
    });
  });
  

  function addToCart() {
    if (!selectedSize || !selectedColor) {
      alert('Please select both size and color before adding to cart.');
      return;
    }

    const cartItem = {
      id: product._id,
      name: product.name,
      size: selectedSize,
      color: selectedColor,
      price: product.price,
      discount: product.discount,
      image: product.image,
    };

    const existingCart = JSON.parse(localStorage.getItem("cart")) || [];
    existingCart.push(cartItem);
    localStorage.setItem("cart", JSON.stringify(existingCart));

    window.location.href = "/cart";
  }

  function addToWishlist() {
    const wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];
    const exists = wishlist.find(item => item.id === product._id);
    if (!exists) {
      wishlist.push({ id: product._id, name: product.name, image: product.image });
      localStorage.setItem("wishlist", JSON.stringify(wishlist));
      alert("Added to wishlist!");
    } else {
      alert("Already in wishlist!");
    }
  }
</script>